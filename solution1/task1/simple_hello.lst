     1                                  ; (*) Ошибки обработчиков ошибок не обрабатываются
     2                                  ; (*) r13 зарезервирован под код выполнения программы:
     3                                  ;   r13 = 0 - Успешное выполнение программы
     4                                  ;   r13 > 0 - Количество записанных байт не соотвествует ожидаемому значению
     5                                  ;   r13 < 0 - Системный вызов провалился
     6                                  
     7                                  %define EXIT 60         ; 60 - номер системного вызова exit
     8                                  %define WRITE 1         ; 1 - номер системного вызова write
     9                                  
    10                                  %define STDOUT 1        ; 1 - дескриптор стандартного вывода
    11                                  %define STDERR 2        ; 2 - дескриптор стандартного потока ошибок
    12                                  
    13                                  %define NULL_CHAR 0     ; код символа '\0'
    14                                  %define NEWLINE 0x0A    ; код символа перевода строки '\n'
    15                                  
    16                                  global _start                                           ; делаем метку _start видимой извне
    17                                  
    18                                  section .data                                           ; секция данных
    19 00000000 48656C6C6F20576F72-         hello_msg db "Hello World!", NEWLINE                ; строка для вывода на консоль
    19 00000009 6C64210A           
    20                                      hello_msg_len equ $ - hello_msg
    21                                  
    22 0000000D 4572726F723A207772-         write_failed_msg db "Error: write() failed", NEWLINE, NULL_CHAR                                     ; сообщение об ошибке write
    22 00000016 697465282920666169-
    22 0000001F 6C65640A00         
    23                                      write_failed_msg_len equ $ - write_failed_msg                                                       ; длина сообщения
    24 00000024 4572726F723A207772-         write_byte_number_mismatch_msg db "Error: write() write wrong number of bytes", NEWLINE, NULL_CHAR  ; ошибка записи неправильного количества байт
    24 0000002D 697465282920777269-
    24 00000036 74652077726F6E6720-
    24 0000003F 6E756D626572206F66-
    24 00000048 2062797465730A00   
    25                                      write_byte_number_mismatch_msg_len equ $ - write_byte_number_mismatch_msg                           ; длина сообщения
    26                                  
    27                                  section .text                                           ; объявление секции кода
    28                                  _start:                                                 ; точка входа в программу
    29 00000000 4D31ED                      xor r13, r13                                        ; обнуляем r13, резервируем его для хранения кода ошибки
    30                                  
    31                                      ; Блок записи данных в файл
    32 00000003 B801000000                  mov rax, WRITE                                      ; указываем код системного вызова
    33 00000008 BF01000000                  mov rdi, STDOUT                                     ; передаём код дескриптора
    34 0000000D 48BE-                       mov rsi, hello_msg                                  ; адрес строки для вывода
    34 0000000F [0000000000000000] 
    35 00000017 BA0D000000                  mov rdx, hello_msg_len                              ; количество байтов
    36 0000001C 0F05                        syscall                                             ; выполняем системный вызов
    37                                  
    38 0000001E 4885C0                      test rax, rax                                       ; проверяем знаковый флаг
    39 00000021 7807                        js write_failed_handler                             ; js - "jump if sign flag is set"
    40                                  
    41 00000023 4839D0                      cmp rax, rdx
    42 00000026 7522                        jne write_byte_number_mismatch_handler
    43                                  
    44                                      ; Блок выхода из программы
    45 00000028 EB40                        jmp exit
    46                                  
    47                                  write_failed_handler:
    48 0000002A 4989C5                      mov r13, rax                                        ; сохраняем отрицательный код ошибки
    49                                  
    50 0000002D B801000000                  mov rax, WRITE                                      ; указываем код системного вызова
    51 00000032 BF02000000                  mov rdi, STDERR                                     ; передаём код дескриптора
    52 00000037 48BE-                       mov rsi, write_failed_msg                           ; адрес строки для вывода
    52 00000039 [0D00000000000000] 
    53 00000041 BA17000000                  mov rdx, write_failed_msg_len                       ; количество байтов
    54 00000046 0F05                        syscall                                             ; выполняем системный вызов
    55                                  
    56 00000048 EB20                        jmp exit
    57                                  
    58                                  write_byte_number_mismatch_handler:                     ; метка обработчика несоответствия байт
    59 0000004A 4989C5                      mov r13, rax                                        ; сохраняем код ошибки
    60                                  
    61 0000004D B801000000                  mov rax, WRITE                                      ; указываем код системного вызова
    62 00000052 BF02000000                  mov rdi, STDERR                                     ; передаём код дескриптора
    63 00000057 48BE-                       mov rsi, write_byte_number_mismatch_msg             ; адрес сообщения
    63 00000059 [2400000000000000] 
    64 00000061 BA2C000000                  mov rdx, write_byte_number_mismatch_msg_len         ; длина сообщения
    65 00000066 0F05                        syscall                                             ; выполняем системный вызов
    66                                  
    67 00000068 EB00                        jmp exit                                            ; завершение программы
    68                                  
    69                                  exit:                                                   ; метка выхода
    70 0000006A 4C89EF                      mov rdi, r13                                        ; передаём код выполнения программы
    71 0000006D B83C000000                  mov rax, EXIT                                       ; указываем код системного вызова
    72 00000072 0F05                        syscall                                             ; выполняем системный вызов
